var e = getApp(); Page({ data: { isIpx: e.globalData.isIpx, radioItems: [{ name: "男孩", value: "male" }, { name: "女孩", value: "female" }], agreementRadioItems: [{ name: "同意", value: "agree" }, { name: "不同意", value: "disagree" }], form: { extra: { agreed_to_public: void 0 }, child: {}, children: [], contact: { mobile: e.globalData.userInfo ? e.globalData.userInfo.mobile : "", name: e.globalData.userInfo ? e.globalData.userInfo.name : "" }, shipping_address: {} } }, onLoad: function (a) { var i = e.globalData.userInfo; if (i) { if (i.children.length) { var o = i.children[0], t = this.data.radioItems, s = t.find(function (e) { return e.value === o.gender }); if (s && (s.checked = !0), i.shipping_address) { var n = i.shipping_address.address + "\n" + i.shipping_address.recipient + " " + i.shipping_address.mobile; this.setData({ shipping_address_text: n, "form.shipping_address": i.shipping_address }) } this.setData({ radioItems: t, "form.child": o }), console.info("set default userInfo", this.data.form.child) } (i.mobile || i.name) && this.setData({ "form.contact.mobile": i.mobile || "", "form.contact.name": i.name || "" }) } console.log("this.data.form", this.data.form) }, onReady: function () { }, onShow: function () { }, onHide: function () { }, onUnload: function () { }, onPullDownRefresh: function () { }, onReachBottom: function () { }, onShareAppMessage: function () { }, bindDateChange: function (e) { console.info("生日切换", e), this.setData({ "form.child.birthday": e.detail.value }) }, bindChooseAddr: function () { var e = this; wx.chooseAddress({ success: function (a) { console.log("bindChooseAddr", a); var i = { address: [a.provinceName, a.cityName, a.countyName, a.detailInfo].join(""), recipient: a.userName, mobile: a.telNumber }, o = i.address + "\n" + i.recipient + " " + i.mobile; e.setData({ shipping_address_text: o, "form.shipping_address": i }) } }) }, bindRadioChange: function (e) { console.log("radio发生change事件，携带value值为：", e.detail.value); for (var a = this.data.radioItems, i = 0, o = a.length; i < o; ++i)a[i].checked = a[i].value == e.detail.value; this.setData({ radioItems: a, "form.child.gender": e.detail.value }) }, bindAgreementRadioChange: function (e) { console.log("radio发生change事件，携带value值为：", e.detail.value); for (var a = this.data.agreementRadioItems, i = 0, o = a.length; i < o; ++i)a[i].checked = a[i].value == e.detail.value; this.setData({ agreementRadioItems: a, "form.extra.agreed_to_public": "agree" === e.detail.value }), console.info(this.data.form) }, showToast: function (e) { wx.showToast({ title: e, icon: "none", duration: 2e3, success: function () { } }) }, formSubmit: function (a) { console.log("form发生了submit事件，携带数据为：", a.detail.value), console.log("data", this.data); var i = a.detail.value; return i["contact.name"] && i["contact.mobile"] ? (console.log("formObject", i), !i["child.name"] || !i["child.nickname"] || this.data.form.child && !this.data.form.child.gender ? this.showToast("请填写宝宝信息") : i["child.birthday"] ? i["shipping_address.address"] ? i["shipping_address.recipient"] ? i["shipping_address.mobile"] ? void 0 === this.data.form.extra.agreed_to_public ? this.showToast("是否同意将拍摄作品用于客片展示") : (this.setData({ "form.children": [{ name: i["child.name"], nickname: i["child.nickname"], gender: this.data.form.child.gender, birthday: this.data.form.child.birthday }], "form.contact.mobile": i["contact.mobile"], "form.contact.name": i["contact.name"], "form.shipping_address": { address: i["shipping_address.address"], recipient: i["shipping_address.recipient"], mobile: i["shipping_address.mobile"] } }), e.globalData.cart.info = this.data.form, console.info("app.globalData.cart.info", this.data.form), void wx.navigateTo({ url: "/pages/order-confirm/order-confirm", success: function (e) { }, fail: function (e) { }, complete: function (e) { } })) : this.showToast("请填写收件人电话") : this.showToast("请填写收件人信息") : this.showToast("请选择收件地址") : this.showToast("请填写宝宝生日")) : this.showToast("请填写联系方式") } }); 