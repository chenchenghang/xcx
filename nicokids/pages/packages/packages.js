var t = getApp(), e = require("../../utils/util.js"), a = function (t, a) { return t.forEach(function (t) { t.packages = [], t.gallery = [], a.forEach(function (a) { a.selected = !1, a.category && a.category.id == t.id && (t.gallery = e.shuffle(t.gallery.concat(a.gallery)).slice(0, 20), t.gallery = e.appendProcessSuffix(t.gallery), a.title.includes("L1") ? a.icon = o("l1") : a.title.includes("L2") ? a.icon = o("l2") : a.title.includes("F1") ? a.icon = o("f1") : a.title.includes("F2") ? a.icon = o("f2") : a.title.includes("B1") ? a.icon = o("b1") : a.title.includes("B2") ? a.icon = o("b2") : a.title.includes("T1") ? a.icon = o("t1") : a.title.includes("T2") ? a.icon = o("t2") : a.title.includes("T3") ? a.icon = o("t3") : a.icon = o("t0"), t.title.includes("小主题") && "T" !== a.title[0] && (a.available_for_sales = !1), a.options.length && (a.tips = a.options[0].content), t.packages.push(a), t.packages.sort(function (t, e) { return t > e })) }), t.title.includes("BABY") && (t.info = n("NICOBABY")), t.title.includes("LOOK") && (t.info = n("NICOLOOK")), t.title.includes("FACE") && (t.info = n("NICOFACE")), t.title.includes("THEME") && (t.info = n("THEME")) }), console.log("categories", t), t }, o = function (t) { return "https://nicokids-storage.oss-cn-hangzhou.aliyuncs.com/mp-images/icon-" + t + ".png" }, n = function (t) { return { NICOBABY: { title: "NICOBABY", slogan: "亲密 爱", recommend_age: "只为1周岁" }, NICOLOOK: { title: "NICOLOOK", slogan: "大片 创意", recommend_age: "2周岁以上" }, NICOFACE: { title: "NICOFACE", slogan: "纯净 纯白", recommend_age: "只为1周岁" }, THEME: { title: "小主题", slogan: "创意海报款", recommend_age: "" } }[t] }; Page({ data: { systemInfo: t.globalData.systemInfo, isIpx: t.globalData.isIpx, detailModalShow: !1, shoppingModalShow: !1, storeId: "", totalPrice: 0, totalPriceDiscounted: 0, shoppingCart: [], disabledScroll: !1, categories: [], gallery: {} }, onLoad: function (t) { wx.showLoading({ title: "读取套餐" }), this.setData({ storeId: t.store_id }), this.initData(t.store_id) }, onReady: function () { }, onShow: function () { }, onHide: function () { }, onUnload: function () { }, onPullDownRefresh: function () { }, onReachBottom: function () { }, onShareAppMessage: function () { }, initData: function (e) { var o = this; Promise.all([t.getRequest(t.globalData.BASE_URL + "/stores/" + e, {}), t.getRequest(t.globalData.BASE_URL + "/product/categories?store_id=" + e, {}), t.getRequest(t.globalData.BASE_URL + "/product/items?store_id=" + e, {})]).then(function (t) { var e = a(t[1], t[2]); o.setData({ store: t[0], packageLoaded: !0, categories: e }), wx.hideLoading() }) }, selectPackage: function (e) { var a = e.currentTarget.dataset.categoryindex, o = e.currentTarget.dataset.packageindex, n = [], i = this.data.categories, c = 0, s = 0; this.data.categories[a].packages.forEach(function (t, e) { t.selected = e === o && !t.selected }), i.forEach(function (t) { t.packages.forEach(function (t) { t.selected && n.push(t) }) }), n.forEach(function (e) { console.info("check inventory_restrictions", e.inventory_restrictions), "weekend" === e.inventory_restrictions && (t.globalData.cart.inventory_restrictions = "weekend"), c += e.price, s += e.advance_price }), this.setData({ shoppingCart: n, categories: this.data.categories, totalPrice: c }), t.globalData.cart.items = n, t.globalData.cart.totalPrice = c, t.globalData.cart.prepaidPrice = s }, getDiscountPrice: function (e, a) { var o = []; e.forEach(function (t) { o.push({ item_id: t.id }) }), t.postRequest(t.globalData.BASE_URL + "/checkAvailableDiscounts", { cart_items: o, total_amount: a }).then(function (t) { console.log(t) }) }, openDetailView: function (t) { var a = t.currentTarget.dataset.packageid, o = t.currentTarget.dataset.categoryid, n = this.data.categories.find(function (t) { return t.id === o }), i = n.packages.find(function (t) { return t.id === a }); i.gallery = i.gallery.length < 1 ? n.gallery : i.gallery, i.gallery = e.shuffle(i.gallery).slice(0, 10), console.log("detailModalData.category->", n), this.openDetailModal({ package: i, category: n }) }, openDetailModal: function (t) { this.setData({ detailModalShow: !0, disabledScroll: !0, detailModalData: t }) }, closeDetailModal: function () { this.setData({ detailModalShow: !1, disabledScroll: !1, detailModalData: {} }) }, switchShoppingModal: function () { this.setData({ shoppingModalShow: !this.data.shoppingModalShow, disabledScroll: !this.data.disabledScroll }) }, packagePickDate: function () { var t = this.data.storeId; wx.navigateTo({ url: "/pages/schedule/schedule?store_id=" + t, success: function (t) { }, fail: function (t) { }, complete: function (t) { } }) }, lookMore: function () { wx.navigateTo({ url: "/pages/guest-photos/guest-photos", success: function (t) { }, fail: function (t) { }, complete: function (t) { } }) }, onPreviewSlides: function (t) { var e = t.currentTarget.dataset.url, a = (t.currentTarget.dataset.categoryid, []); this.data.categories.forEach(function (t) { t.gallery.forEach(function (t) { a.push(t.url.raw) }) }), wx.previewImage({ current: e, urls: a }) }, makeCall: function (e) { var a = t.globalData.stores, o = e.currentTarget.dataset.storeid, n = a.find(function (t) { return t.id === o }); wx.makePhoneCall({ phoneNumber: n.phone, success: function (t) { }, fail: function (t) { }, complete: function (t) { } }) }, openLocationHandler: function (e) { var a = t.globalData.stores, o = e.currentTarget.dataset.storeid, n = a.find(function (t) { return t.id === o }); wx.openLocation({ name: n.name, address: n.location, latitude: n.gps_coordinates[1] - 0, longitude: n.gps_coordinates[0] - 0, success: function (t) { t.latitude, t.longitude } }) }, getLocations: function () { wx.getLocation({ type: "gcj02", success: function (t) { var e = t.latitude, a = t.longitude; wx.openLocation({ latitude: e, longitude: a, scale: 28 }) } }) }, wechatContact: function (e) { var a = t.globalData.stores, o = e.currentTarget.dataset.storeid, n = a.find(function (t) { return t.id === o }); wx.setClipboardData({ data: n.wechat, success: function (t) { wx.showToast({ title: "微信已复制", icon: "success", image: "", duration: 0, mask: !0, success: function (t) { }, fail: function (t) { }, complete: function (t) { } }) }, fail: function (t) { }, complete: function (t) { } }) }, loadMorePhotos: function (t) { var e = t.currentTarget.dataset.category, a = t.currentTarget.dataset.package; console.log("loadMorePhotos", e, a), wx.navigateTo({ url: "/pages/photos/photos?category_id=" + e + "&package_id=" + a, success: function (t) { }, fail: function (t) { }, complete: function (t) { } }) } });